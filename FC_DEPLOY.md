# 阿里云函数计算（FC）部署指南

本文档介绍如何将GPT-SoVITS部署到阿里云函数计算上。

## 前置准备

1. 已有阿里云账号，并开通函数计算服务
2. 已将代码上传到GitHub或其他代码托管平台
3. 已安装并配置好阿里云CLI或使用阿里云控制台

## 部署步骤

### 1. 准备模型文件

由于模型文件较大，建议将其存储在对象存储（OSS）中，然后在构建函数时下载：

1. 在阿里云OSS中创建一个存储桶
2. 上传所有必要的模型文件到该存储桶
3. 记录文件的访问URL或创建访问凭证

### 2. 构建自定义镜像

#### 方式一：基于代码仓库自动构建

1. 登录阿里云控制台，打开函数计算
2. 选择"应用">"通过仓库导入应用"
3. 选择GitHub，授权并选择您的代码仓库
4. 选择自定义镜像部署方式
5. 设置构建命令，包括从OSS下载模型文件的命令
6. 设置应用名称、环境变量等
7. 部署应用

#### 方式二：本地构建并推送镜像

1. 在本地环境完成Dockerfile准备

2. 构建Docker镜像：
```bash
# 添加必要模型到镜像
mkdir -p models_temp
# 在此目录下载放置所有必要模型文件
cp -r models_temp/* GPT_SoVITS/pretrained_models/

# 构建镜像
docker build -t gptsovits:v1 .
```

3. 推送到阿里云容器镜像服务：
```bash
# 登录阿里云容器镜像服务
docker login --username=<阿里云账号> registry.<地域>.aliyuncs.com

# 为镜像打标签
docker tag gptsovits:v1 registry.<地域>.aliyuncs.com/<命名空间>/gptsovits:v1

# 推送镜像
docker push registry.<地域>.aliyuncs.com/<命名空间>/gptsovits:v1
```

4. 在函数计算控制台：
   - 创建应用
   - 选择"自定义镜像"部署方式
   - 填入镜像地址
   - 设置端口映射（9880）
   - 部署应用

### 3. 配置资源和网络

1. 根据GPT-SoVITS的运行需求，推荐配置：
   - 内存：至少4GB
   - CPU：至少2核
   - GPU：视具体需求决定是否使用

2. 网络配置：
   - 选择VPC网络以保证安全性
   - 配置公网访问（如需外部访问）
   - 设置域名（可选）

### 4. 使用自定义域名（可选）

如需使用自定义域名访问服务：
1. 在阿里云DNS管理中添加域名解析记录
2. 在函数计算控制台绑定自定义域名
3. 配置HTTPS证书（推荐）

## 性能优化与成本控制

1. 根据访问量调整实例数和弹性策略
2. 考虑使用预留实例降低成本
3. 监控资源使用情况，及时调整配置

## 故障排查

如遇部署或运行问题：
1. 检查日志输出
2. 验证模型文件是否正确加载
3. 检查网络配置是否正确
4. 确认资源是否足够 